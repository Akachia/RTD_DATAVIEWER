<?xml version="1.0" encoding="utf-8" ?>
<SqlList>
	<btnOK_Click>
		<MainSQL>
				SELECT CC.CSTID
					, H.FROM_PORT_iD AS 요청포트
					, H.TO_PORT_ID AS 목적포트
					, H.CSTSTAT AS 상태
					, CC.ABNORM_TRF_RSN_CODE AS ATRC
					, CC.CURR_LOTID AS LOTID 
					, WA.LANE_ID AS LANE_ID 
					, W.ROUTID AS ROUT 
					, W.PROCID AS PROCID
					, W.WIPSTAT AS WIP
					, H.RTD_RULE_ID 
					, H.CMD_STAT_CODE AS 진행상태
					, H.INSUSER AS 요청
					, H.REQ_SEQNO AS 순번
					, H.CNCL_REQ_FLAG AS 취소
					, CONVERT(CHAR(23), H.INSDTTM, 20) AS 요청시각
					, CONVERT(CHAR(23), H.UPDDTTM, 20) AS 수정시각
					, (CASE WHEN (DATEDIFF(minute, H.INSDTTM, GETDATE())>=60) THEN '1' ELSE 'O' END)  AS CMDCHK 
					, H.RSPN_CODE AS RSPN
				, C.CMCDNAME AS ERR_MSG AS MSG
				FROM CARRIER CC with(nolock)
		</MainSQL>
		<Option>
			<Option1>
				INNER JOIN TB_MHS_TRF_CMD_HIST H with(nolock) ON H.CSTID = CC.CSTID  
			</Option1>
			<Option2>
				INNER JOIN TB_MHS_TRF_CMD H with(nolock) ON H.CSTID = CC.CSTID 
			</Option2>
			<Option3>
				LEFT JOIN WIP W with(nolock) ON W.LOTID = CC.CURR_LOTID 
				LEFT JOIN WIPATTR WA with(nolock) ON WA.LOTID = W.LOTID
				LEFT JOIN COMMONCODE C with(nolock) ON C.CMCDTYPE = 'TRF_REQ_ERR_CODE' AND C.CMCODE = H.RSPN_CODE
			</Option3>
			<Option4>
				WHERE  1=1
			</Option4>
			<Option5>
				WHERE CONVERT(CHAR(10), H.INSDTTM, 20) BETWEEN @StartDate AND @EndDate
			</Option5>
			<Option6>
				AND WA.LANE_ID LIKE @LANE_ID
			</Option6>
			<Option7>
				AND H.CMD_STAT_CODE IN ('MOVING','RECEIVE','ABNORMAL_END')
                AND ISNULL(H.CNCL_REQ_FLAG, '') NOT IN ('Y', 'S')
			</Option7>
			<Option8>
				AND H.CMD_STAT_CODE IN ('ABNORMAL_END')
			</Option8>
			<Option9>
				AND H.CMD_STAT_CODE IN ('MOVING','RECEIVE')
				AND ISNULL(H.CNCL_REQ_FLAG, '') NOT IN ('Y', 'S')
			</Option9>
			<Option10>
				<![CDATA[AND H.CMD_STAT_CODE <> 'DELETE']]></Option10>
			<Option11>
				AND H.CSTSTAT = @CSTSTAT
			</Option11>
			<Option12>
				AND H.CSTID LIKE @CSTID
			</Option12>
			<Option13>
				AND H.FROM_PORT_ID LIKE @ReqPortId
			</Option13>
			<Option14>
				AND H.TO_PORT_ID LIKE @ToPortId
			</Option14>
			<Option15>
				AND CC.ABNORM_TRF_RSN_CODE = 'STACK_VALID_ERROR 
			</Option15>
			<Option16>
				<![CDATA[AND H.INSUSER <> 'MCS(SYNC)' ORDER BY H.INSDTTM DESC]]>
			</Option16>
		</Option>
	</btnOK_Click>
	<ReqList>
		<MainSQL>
				SELECT
				   REQ.REQ_SEQNO
				 , REQ.CSTID AS CSTID_R
				 , REQ.CSTSTAT AS CSTSTAT_R
				 , REQ.EQPTID AS EQPTID_R
				 , REQ.PORT_ID AS PORT_ID_R
				 , REQ.REQ_TYPE_CODE AS REQ_TYPE_CODE_R
				 , REQ.PRCS_TYPE_CODE
				 , REQ.RTD_RULE_ID AS RTD_RULE_ID_R
				 , REQ.INSUSER AS INSUSER_R
				 , CONVERT(CHAR(23), REQ.INSDTTM, 20) AS INSDTTM_R
				 , CONVERT(CHAR(23), REQ.UPDDTTM, 20) AS UPDDTTM_R
				 , REQ.REQ_STAT_CODE
				 , REQ.REQ_SEQS
				 , REQ.RTD_EXEC_LOG_CNTT
				 , REQ.ERR_CODE
				 , C.CMCDNAME AS ERR_DESC
				FROM TB_MHS_TRF_REQ REQ with(nolock)
				LEFT JOIN COMMONCODE     C with(nolock) ON C.CMCDTYPE = 'TRF_REQ_ERR_CODE' AND C.CMCODE = REQ.ERR_CODE
				WHERE 1 = 1 
			</MainSQL>
		<Option>
			<Option1>
				AND REQ.CSTID like @CSTID 
			</Option1> 
			<Option2>
				 AND CONVERT(CHAR(10), REQ.INSDTTM, 20) BETWEEN @StartDate AND @EndDate 
			</Option2>
			<Option3>
				AND REQ.EQPTID LIKE @EQPTID 
			</Option3>
			<Option4>
				AND REQ.RTD_RULE_ID LIKE @RuleId 
			</Option4>
			<Option5>
				AND REQ.REQ_STAT_CODE = 'QUERY' 
			</Option5>
			<Option6>
				ORDER BY REQ.CSTID, REQ.UPDDTTM DESC 
			</Option6>
		</Option>
	</ReqList>
	<ErrList>
		<MainSQL>
				select 
					SRCTYPE, 
					PGM_ID, 
					BZRULE_ID,
					EXCT_MSG, 
					EXCT_TYPE, 
					DATASET, 
				INSUSER AS INSUSER_E, CONVERT(CHAR(23), INSDTTM, 20) AS INSDTTM_E
				from TB_SOM_BZRULE_ERR_HIST with(nolock)
				where DATEDIFF(dd, INSDTTM, GETDATE())=0 
			</MainSQL>
		<Option>
			<Option1>
				AND (EXCT_MSG LIKE @ErrText OR EXCT_TYPE LIKE @ErrText)
			</Option1>
			<Option2>
				 ORDER BY INSDTTM DESC 
			</Option2>
		</Option>
	</ErrList>
	<CST_List>
		<MainSQL>
			SELECT
			C.CSTID,
			C.CSTSTAT,
			C.LOAD_REP_CSTID,
			C.CST_LOAD_LOCATION_CODE,
			C.CURR_RACK_ID,
			C.CURR_LOTID,
			C.TRF_STAT_CODE,
			C.ABNORM_TRF_RSN_CODE,
			C.EQPT_CUR AS EQPTID,
			C.PORT_CUR AS PORT_ID,
			W.ROUTID,
			W.WIPSTAT,
			L.LOTTYPE,
			WA.DAY_GR_LOTID AS ASSY_LOTID,
			WA.SPCL_FLAG,
			WA.LOT_DETL_TYPE_CODE,
			WA.DFCT_LIMIT_OVER_FLAG,
			WA.SPCL_NOTE,
			WA.FORM_SPCL_GR_ID,
			W.PROCID,
			C.TRAY_TYPE_CODE,
			CONVERT(
			CHAR(23),
			C.UPDDTTM,
			20
			) AS UPDDTTM,
			WA.DFCT_OCCR_EQPTID,
			WA.SCRP_TRAY_FLAG,
			WA.TRAY_CNVR_BCR_SCAN_COUNT,
			CONVERT(
			CHAR(23),
			WA.AGING_ISS_SCHD_DTTM,
			20
			) AS AGING_ISS_SCHD_DTTM,
			WA.AGING_ISS_PRIORITY_NO
			FROM
			Carrier C with(nolock)
			LEFT JOIN WIP W WITH(NOLOCK) ON C.CURR_LOTID = W.LOTID
			LEFT JOIN WIPATTR WA WITH(NOLOCK) ON WA.LOTID = W.LOTID
			LEFT JOIN LOT L WITH(NOLOCK) ON L.LOTID = WA.LOTID
			WHERE (LOAD_REP_CSTID LIKE @CSTID or C.CSTID LIKE @CSTID)
			ORDER BY UPDDTTM DESC,CST_LOAD_LOCATION_CODE DESC
		</MainSQL>
		<Option>
			<Option1>
				Select * from CARRIER with(NOLOCK) where IN (@CSTID1, @CSTID2)
			</Option1>
		</Option>
	</CST_List>
	<Job_state>
		<MainSQL>
			SELECT C.CSTID,                    C.CSTSTAT,                      C.LOAD_REP_CSTID,
			C.CST_LOAD_LOCATION_CODE,   C.CURR_RACK_ID,                 C.CURR_LOTID,       C.TRF_STAT_CODE, C.ABNORM_TRF_RSN_CODE,
			C.EQPT_CUR AS EQPTID,       C.PORT_CUR AS PORT_ID,          W.ROUTID,           W.WIPSTAT,
			L.LOTTYPE,                  WA.DAY_GR_LOTID AS ASSY_LOTID,  WA.SPCL_FLAG,
			WA.LOT_DETL_TYPE_CODE,      WA.DFCT_LIMIT_OVER_FLAG,        WA.SPCL_NOTE,
			WA.FORM_SPCL_GR_ID,         W.PROCID,                       C.TRAY_TYPE_CODE,
			CONVERT(CHAR(23), C.UPDDTTM, 20) AS UPDDTTM,                WA.DFCT_OCCR_EQPTID,
			WA.SCRP_TRAY_FLAG,          WA.TRAY_CNVR_BCR_SCAN_COUNT,    CONVERT(CHAR(23),WA.AGING_ISS_SCHD_DTTM, 20) AS AGING_ISS_SCHD_DTTM ,
			WA.AGING_ISS_PRIORITY_NO
			FROM Carrier C with(nolock)
			LEFT JOIN WIP W WITH(NOLOCK) ON C.CURR_LOTID = W.LOTID
			LEFT JOIN WIPATTR WA WITH(NOLOCK) ON WA.LOTID = W.LOTID
			LEFT JOIN LOT L WITH(NOLOCK) ON L.LOTID = WA.LOTID
		</MainSQL>
		<Option>
			<Option1>
				WHERE (LOAD_REP_CSTID LIKE '%" + CSTID + "%' or C.CSTID LIKE '%" + CSTID + "%')
			</Option1>
			<Option2>
				ORDER BY UPDDTTM DESC,CST_LOAD_LOCATION_CODE DESC
			</Option2>
		</Option>
	</Job_state>
	<CST_Hist>
		<MainSQL>
			SELECT
			        CSTID
			      , FROM_EQPTID
			      , FROM_PORT_iD
			      , TO_EQPTID
			      , TO_PORT_ID
			      , CSTSTAT
			      , RTD_RULE_ID
			      , CMD_STAT_CODE
			      , INSUSER
			      , CONVERT(CHAR(23), INSDTTM, 20) AS INSDTTM
			      , CONVERT(CHAR(23), UPDDTTM, 20) AS UPDDTTM
			      , (CASE WHEN (DATEDIFF(minute, INSDTTM, GETDATE())>=60) THEN '1' ELSE 'O' END)  AS CMDCHK
			 FROM TB_MHS_TRF_CMD_HIST with(nolock)
			 WHERE CSTID like @CSTID
			 ORDER BY UPDDTTM DESC
		</MainSQL>
		<Option></Option>
	</CST_Hist>
</SqlList>
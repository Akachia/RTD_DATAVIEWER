<?xml version="1.0" encoding="utf-8" ?>
<SearchEquipmentCurrentState>
	<MainSQL>
			WITH TT_BUF_SUM AS (
			SELECT
			P.EQPTID,
			ISNULL(sum(CP.MAX_TRF_QTY),0) AS MAX_QTY
			FROM TB_MCS_PORT(NOLOCK) P
			INNER JOIN TB_MCS_CURR_PORT(NOLOCK) CP     ON P.PORT_ID = CP.PORT_ID
			where p.EQPTID like 'C1%'
			GROUP  BY P.EQPTID
			HAVING ISNULL(sum(CP.MAX_TRF_QTY), 0) >= 0
			),
			TT_USING_QTY AS (
			SELECT
			TO_EQPTID
			, ISNULL(COUNT(CSTID),0) AS CMD_USING_QTY
			FROM TB_MHS_TRF_CMD WITH(NOLOCK)
			WHERE CMD_STAT_CODE IN('RECEIVE', 'MOVING')
			AND CSTSTAT = 'U'
			AND ISNULL(CNCL_REQ_FLAG, '') NOT IN('Y', 'S')
			GROUP BY TO_EQPTID
			),
			TT_EMPTY_QTY AS (
			SELECT
			TO_EQPTID
			, ISNULL(COUNT(CSTID),0) AS CMD_EMPTY_QTY
			FROM TB_MHS_TRF_CMD WITH(NOLOCK)
			WHERE CMD_STAT_CODE IN('RECEIVE', 'MOVING')
			AND CSTSTAT = 'E'
			AND ISNULL(CNCL_REQ_FLAG, '') NOT IN('Y', 'S')
			GROUP BY TO_EQPTID
			)
			,
			TT_TOTAL_QTY AS (
			SELECT
			TOT.EQPTID
			, TOT.MAX_QTY
			, CU.CMD_USING_QTY
			, CE.CMD_EMPTY_QTY
			FROM TT_BUF_SUM  TOT
			LEFT JOIN TT_USING_QTY CU ON TOT.EQPTID = CU.TO_EQPTID
			LEFT JOIN TT_EMPTY_QTY CE ON TOT.EQPTID = CE.TO_EQPTID
			)
			SELECT
			e.EQPTID
			, e.EQGRID
			, e.EQPTIUSE AS 사용
			, ei.EIOSTAT
			, ei.EIOIFMODE
			, ea.S71 AS LANE_ID
			, CONVERT(VARCHAR(23), ei.UPDDTTM, 20) AS UPDDTTM
			, ISNULL(Q.MAX_QTY,0) AS MAX_CMD
			, ISNULL(Q.CMD_USING_QTY,0) AS 실반송
			, ISNULL(Q.CMD_EMPTY_QTY,0) AS 공반송
			FROM EQUIPMENT e with(nolock)
			INNER JOIN EQUIPMENTATTR ea with(nolock) ON E.EQPTID = ea.EQPTID
			INNER JOIN EIO ei with(nolock) ON e.EQPTID = ei.EQPTID
			LEFT JOIN TT_TOTAL_QTY Q ON e.EQPTID = Q.EQPTID
			WHERE 1 = 1
			--AND E.EQGRID IN ('CNV','PKG','SEL','HPC','DEG','JGF','FOR','DIS','STO','OCV','EOL','OHS')
			AND (E.EQPTIUSE = 'Y'
			AND E.EQGRID IN (@EQP_GROUP_ID_LIST)
			AND E.EQPTID like @AREA_ID
			AND E.EQGRID IN ('CNV','STO','PKG','EOL','FOR','LAM','NND','ROL','COT','STK')
			and LEN(E.EQPTID) = 11)
			OR
			(E.EQPTIUSE = 'Y'
			AND E.EQGRID IN (@EQP_GROUP_ID_LIST)
			AND E.EQPTID like @AREA_ID
			AND E.EQGRID IN ('SEL','HPC','DEG','JGF','DIS','OCV')
			and LEN(E.EQPTID) = 9)
			Order by E.EQPTID
		</MainSQL>
	<Option/>
	<AdditionalVariable>
		<EQP_GROUP_ID_LIST dataType="NONE" default=""/>
		<AREA_ID dataType="NONE" default=""/>
	</AdditionalVariable>
	<Coloring>
		<EIOSTAT Red="255" Green="155" Blue="155" IsColoringColumn="false" IsTimeCompare="false">
			<F Red="255" Green="155" Blue="155" IsColoringRow="false"/>
			<T Red="255" Green="214" Blue="165" IsColoringRow="false"/>
			<U Red="255" Green="254" Blue="196" IsColoringRow="false"/>
			<W Red="203" Green="255" Blue="169" IsColoringRow="false"/>
			<R Red="203" Green="255" Blue="169" IsColoringRow="false"/>
		</EIOSTAT>
		<EIOIFMODE Red="255" Green="155" Blue="155" IsColoringColumn="false" IsTimeCompare="false">
			<OFF Red="255" Green="158" Blue="158" IsColoringRow="false"/>
			<ON Red="185" Green="243" Blue="252" IsColoringRow="false"/>
		</EIOIFMODE>
		<CSTTYPE Red="255" Green="254" Blue="196" IsColoringColumn="true" IsTimeCompare="false">
			<TRAY Red="255" Green="155" Blue="155" IsColoringRow="false"/>
			<TKAE Red="255" Green="214" Blue="165" IsColoringRow="false"/>
			<U Red="255" Green="254" Blue="196" IsColoringRow="FALSE"/>
		</CSTTYPE>
		<INSDTTM Red="255" Green="155" Blue="155" IsColoringColumn="false" IsTimeCompare="true">
			<TODAY Red="255" Green="155" Blue="155" IsColoringRow="true" condition="FUTURE"/>
			<TOMORROW Red="155" Green="255" Blue="155" IsColoringRow="true" condition="PAST"/>
			<YESTERDAY Red="155" Green="155" Blue="255" IsColoringRow="true" condition="EQUAL"/>
		</INSDTTM>
	</Coloring>
	<EventValues/>
</SearchEquipmentCurrentState>
<?xml version="1.0" encoding="utf-8" ?>
<SearchCurrentTransportJobList>
    <MainSQL>
        SELECT 
		DURB.DURABLE_ID
        , H.FROM_PORT_ID AS 요청포트
        , H.TO_PORT_ID AS 목적포트
        , H.CSTSTAT AS 상태
<!--        , CC.CURR_LOTID AS LOTID-->
<!--        , WA.LANE_ID AS LANE_ID-->
        , LOT.FACTORY_AREA_ID
        , LOT.ROUTE_ID
        , H.CMD_STAT_CODE AS 현황
        , LOT.PRODUCT_SPECIFICATION_ID
        , LOT.PROCESS_CODE
        , LOT.LOT_DETAIL_STATUS_CODE
        , LOT.PRODUCTION_TYPE_CODE
        , H.INSDTTM
        , H.UPDDTTM
        , DURB.ABNORM_TRF_RSN_CODE
        , LOT.HOLD_STATUS_CODE
        , H.RTD_RULE_ID
        , H.TRF_CODE
        , H.INSUSER AS 요청
        , H.REQ_SEQNO AS 순번
        , H.CNCL_REQ_FLAG AS 취소
        , (CASE WHEN (SYSDATE - INTERVAL '60' MINUTE >= H.INSDTTM) THEN '1' ELSE 'O' END) AS CMDCHK  <!--  TODO 60분 이상인지 확인하는 로직 확인필요-->
        , H.RSPN_CODE AS RSPN
        , C.BUSINESS_USAGE_CODE_DESC AS ERR_MSG
        , H.CMD_STAT_CODE
        FROM TB_EGN_DURB_INFO DURB
        INNER JOIN TB_MHS_TRF_CMD H ON H.CSTID = DURB.DURABLE_ID
		LEFT JOIN TB_EGN_LOT_INFO LOT ON LOT.DURABLE_ID = DURB.DURABLE_ID
		LEFT JOIN TB_EGN_CODE_ITEM_INFO C ON C.BUSINESS_USAGE_TYPE_CODE = 'TRF_REQ_ERR_CODE' AND C.BUSINESS_USAGE_CODE_ID = H.RSPN_CODE
		WHERE 1=1
		+Option1
		+Option2  
		+Option3
		+Option4  
		+Option5  
		+Option6
		+Option7
		<![CDATA[AND H.INSUSER <> 'MCS(SYNC)' ORDER BY H.INSDTTM DESC]]>
    </MainSQL>
    <Option>
        <Option1 type="IF" condition="not_equal" key="LANE_ID" dataType="string" default="">
            AND LOT.LANE_ID LIKE @LANE_ID <!--  TODO  전극조립에는 없음 수정필요   -->
        </Option1>
        <Option2 type="IF" condition="not_equal" key="DURABLE_STATUS_CODE" dataType="string" default="">
            AND H.CSTSTAT = @DURABLE_STATUS_CODE
        </Option2>
        <Option3 type="IF" condition="not_equal" key="DURABLE_ID" dataType="string" default="">
            --AND H.CSTID IN (@DURABLE_ID)
        </Option3>
        <Option4 type="IF" condition="not_equal" key="FROM_PORT_ID" dataType="string" default="">
            AND H.FROM_PORT_ID LIKE @FROM_PORT_ID
        </Option4>
        <Option5 type="IF" condition="not_equal" key="TO_PORT_ID" dataType="string" default="">
            AND H.TO_PORT_ID LIKE @TO_PORT_ID
        </Option5>
        <Option6 type="IF" condition="equal" key="isFaulty" dataType="bool" default="True">
            AND DURB.ABNORM_TRF_RSN_CODE = 'STACK_VALID_ERROR'
        </Option6>
        <Option7 type="IF" condition="not_equal" key="CMD_STAT_CODE_LIST" dataType="string" default="">
            AND H.CMD_STAT_CODE IN (@CMD_STAT_CODE_LIST)
        </Option7>
    </Option>
    <AdditionalVariable>
    </AdditionalVariable>
    <Coloring>
        <상태 Red="255" Green="155" Blue="155" IsColoringColumn="false" IsTimeCompare="false">
            <U Red="164" Green="201" Blue="255" IsColoringRow="false"/>
            <E Red="228" Green="239" Blue="255" IsColoringRow="false"/>
        </상태>
        <현황 Red="255" Green="155" Blue="155" IsColoringColumn="false" IsTimeCompare="false">
            <MOVING Red="255" Green="227" Blue="238" IsColoringRow="false"/>
            <RECEIVE Red="255" Green="164" Blue="201" IsColoringRow="false"/>
            <SEND Red="255" Green="100" Blue="163" IsColoringRow="false"/>
        </현황>
        <HOLD Red="255" Green="155" Blue="155" IsColoringColumn="false" IsTimeCompare="false">
            <Y Red="255" Green="155" Blue="155" IsColoringRow="true"/>
        </HOLD>
    </Coloring>
    <EventValues>
        <DURABLE_ID TYPE='string' CallSQL = 'SearchCarrierInfomation' EventType='Click'/>
        <TRF_CODE TYPE='string' CallSQL = 'SearchTransportJobHistory' EventType='Click'/>
        <ROUTE_ID TYPE='string' CallSQL = 'SearchRouteInfo' EventType='Click'/>
    </EventValues>
</SearchCurrentTransportJobList>
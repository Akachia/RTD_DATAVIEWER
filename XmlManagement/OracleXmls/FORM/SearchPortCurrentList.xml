<?xml version="1.0" encoding="utf-8" ?>
<SearchPortCurrentList>
    <MainSQL>
		WITH TT_BUF_SUM AS (SELECT P.PORT_ID,
		NVL(SUM(PI.MAX_TRF_QTY), 0) AS MAX_QTY
		FROM TB_MMD_TRF_PORT P
		INNER JOIN TB_EGN_PORT_INFO PI
		ON PI.REPRESENTATIVE_FACTORY_CODE = P.FACILITY_CODE
		AND PI.PORT_ID = P.PORT_ID
		AND PI.EQUIPMENT_ID = P.EQPTID
		WHERE 1 = 1
		AND P.FACILITY_CODE = @AREA_ID
		AND (SUBSTR(P.PORT_ID, 1, 11) IN (@EQPTID_LIST) OR
		SUBSTR(P.PORT_ID, 1, 9) IN (@EQPTID_LIST)) -- option1
		GROUP BY P.PORT_ID
		HAVING NVL(SUM(PI.MAX_TRF_QTY), 0) >= 0),
		TT_USING_QTY AS (SELECT TO_PORT_ID,
		NVL(COUNT(CSTID), 0) AS CMD_USING_QTY
		FROM TB_MHS_TRF_CMD
		WHERE 1 = 1
		AND FACILITY_CODE = @AREA_ID
		AND CMD_STAT_CODE IN ('RECEIVE', 'MOVING')
		AND CSTSTAT = 'U'
		AND NVL(CNCL_REQ_FLAG, '') NOT IN ('Y', 'S')
		GROUP BY TO_PORT_ID),
		TT_EMPTY_QTY AS (SELECT TO_PORT_ID,
		NVL(COUNT(CSTID), 0) AS CMD_EMPTY_QTY
		FROM TB_MHS_TRF_CMD
		WHERE 1 = 1
		AND FACILITY_CODE = @AREA_ID
		AND CMD_STAT_CODE IN ('RECEIVE', 'MOVING')
		AND CSTSTAT = 'E'
		AND NVL(CNCL_REQ_FLAG, '') NOT IN ('Y', 'S')
		GROUP BY TO_PORT_ID),
		TT_TOTAL_QTY AS (SELECT TOT.PORT_ID,
		TOT.MAX_QTY,
		CU.CMD_USING_QTY,
		CE.CMD_EMPTY_QTY
		FROM TT_BUF_SUM TOT
		LEFT JOIN TT_USING_QTY CU
		ON TOT.PORT_ID = CU.TO_PORT_ID
		LEFT JOIN TT_EMPTY_QTY CE
		ON TOT.PORT_ID = CE.TO_PORT_ID)
		SELECT TMP.PORT_ID,
		TMCP.TRANSFER_STATE_CODE        AS 상태,
		TMCP.ACCESS_MODE_CODE           AS 모드,
		eio.EQUIPMENT_STATE_CODE        AS ES,
		eio.EIOIFMODE                   AS EIM,
		TTQ.MAX_QTY                     AS 버퍼,
		TTQ.CMD_USING_QTY               AS 실반송량,
		TTQ.CMD_EMPTY_QTY               AS 공반송량,
		TMP.PORT_TYPE_CODE              AS PORT_TYPE,
		TMP.INOUT_TYPE_CODE             AS INOUT,
		TMP.USE_FLAG                    AS 사용여부,
		TMP.ELTR_TYPE_CODE              AS 극성,
		TMP.EQPTID,
		TMP.IF_EQPTID,
		TMP.REP_PORT_FLAG               AS 대표포트,
		TMP.MANL_PORT_TYPE_CODE         AS 포트,
		TMP.MAX_TRF_QTY_MNGT_FLAG       AS 버퍼사용,
		TMP.SKIP_TRGT_REQ_TRF_TYPE_CODE AS 스킵유형,
		TMP.INPUT_ENABLE_CSTSTAT        AS 투입CSTSTAT,
		TMP.LOAD_ENABLE_WIPSTAT_LST     AS 투입WIPSTAT,
		TMP.STACK_MODE_CODE             AS 적재모드,
		E.EQPTSHORTNAME,
		TMCP.CA_BUF_QTY                 AS C버퍼,
		TMCP.AN_BUF_QTY                 AS A버퍼
		FROM TB_MMD_TRF_PORT TMP
		INNER JOIN TB_EGN_PORT_INFO TMCP
		ON TMCP.REPRESENTATIVE_FACTORY_CODE = TMP.FACILITY_CODE
		AND TMCP.PORT_ID = TMP.PORT_ID
		INNER JOIN TB_EGN_EQUIP_SPEC_MST E
		ON E.REPRESENTATIVE_FACTORY_CODE = TMP.FACILITY_CODE
		AND E.EQUIPMENT_ID = TMP.EQPTID
		INNER JOIN TB_EGN_FCTRY_AREA_MST ESA
		ON ESA.REPRESENTATIVE_FACTORY_CODE = TMP.FACILITY_CODE
		AND E.FACTORY_AREA_ID = ESA.FACTORY_AREA_ID
		INNER JOIN TT_TOTAL_QTY TTQ
		ON TMCP.PORT_ID = TTQ.PORT_ID
		INNER JOIN TB_EGN_EQUIP_INFO eio
		ON eio.REPRESENTATIVE_FACTORY_CODE = TMP.FACILITY_CODE
		AND TMCP.PORT_ID = eio.EQUIPMENT_ID
		WHERE 1 = 1
		AND TMP.FACILITY_CODE = @AREA_ID
		AND E.USE_FLAG = 'Y'
		ORDER BY E.EQUIPMENT_ID
	</MainSQL>
    <Option>
        <Option1 type="VAR" condition="not_equal" key="EQPTID_LIST" dataType="string" default=""/>
        <Option2 type="VAR" condition="not_equal" key="AREA_ID" dataType="string" default=""/>
    </Option>
    <AdditionalVariable/>
    <Coloring>
        <ES Red="255" Green="155" Blue="155" IsColoringColumn="false" IsTimeCompare="false">
            <F Red="255" Green="155" Blue="155" IsColoringRow="false"/>
            <T Red="255" Green="214" Blue="165" IsColoringRow="false"/>
            <U Red="255" Green="254" Blue="196" IsColoringRow="false"/>
            <W Red="203" Green="255" Blue="169" IsColoringRow="false"/>
            <R Red="203" Green="255" Blue="169" IsColoringRow="false"/>
        </ES>
        <EIM Red="255" Green="155" Blue="155" IsColoringColumn="false" IsTimeCompare="false">
            <OFF Red="255" Green="158" Blue="158" IsColoringRow="false"/>
            <ON Red="185" Green="243" Blue="252" IsColoringRow="false"/>
        </EIM>
        <MAINT_FLAG Red="255" Green="155" Blue="155" IsColoringColumn="false" IsTimeCompare="false">
            <M Red="255" Green="158" Blue="158" IsColoringRow="true"/>
        </MAINT_FLAG>
    </Coloring>
    <EventValues/>
    <ColumnCount/>
</SearchPortCurrentList>
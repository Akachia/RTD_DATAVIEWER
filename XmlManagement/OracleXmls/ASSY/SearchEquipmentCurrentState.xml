<?xml version="1.0" encoding="utf-8" ?>
<SearchEquipmentCurrentState>
    <MainSQL>
		WITH TT_BUF_SUM AS ( /*+ materialize */
		SELECT TMTP.EQPTID,
		NVL(SUM(TEP.MAX_TRF_QTY), 0) AS MAX_QTY
		FROM TB_MMD_TRF_PORT TMTP
		INNER JOIN TB_EGN_PORT_INFO TEP
		ON TEP.REPRESENTATIVE_FACTORY_CODE = TMTP.FACILITY_CODE
		AND TEP.EQUIPMENT_ID = TMTP.EQPTID
		AND TEP.PORT_ID = TMTP.PORT_ID
		INNER JOIN TB_EGN_EQUIP_SPEC_MST E
		ON E.REPRESENTATIVE_FACTORY_CODE = TMTP.FACILITY_CODE
		AND E.EQUIPMENT_ID = TMTP.EQPTID
		INNER JOIN TB_EGN_FCTRY_AREA_MST ES
		ON ES.REPRESENTATIVE_FACTORY_CODE = TMTP.FACILITY_CODE
		AND ES.FACTORY_AREA_ID = E.FACTORY_AREA_ID
		WHERE 1 = 1
		AND TMTP.FACILITY_CODE = @AREA_ID -- Option3
		GROUP BY TMTP.EQPTID),
		TT_USING_QTY AS (SELECT TO_EQPTID,
		NVL(COUNT(CSTID), 0) AS CMD_USING_QTY
		FROM TB_MHS_TRF_CMD
		WHERE 1 = 1
		AND FACILITY_CODE = @AREA_ID
		AND CMD_STAT_CODE IN ('RECEIVE', 'MOVING')
		AND CSTSTAT = 'U'
		AND NVL(CNCL_REQ_FLAG, 'N') NOT IN ('Y', 'S')
		GROUP BY TO_EQPTID),
		TT_EMPTY_QTY AS (SELECT TO_EQPTID,
		NVL(COUNT(CSTID), 0) AS CMD_EMPTY_QTY
		FROM TB_MHS_TRF_CMD
		WHERE 1 = 1
		AND FACILITY_CODE = @AREA_ID
		AND CMD_STAT_CODE IN ('RECEIVE', 'MOVING')
		AND CSTSTAT = 'E'
		AND NVL(CNCL_REQ_FLAG, 'N') NOT IN ('Y', 'S')
		GROUP BY TO_EQPTID),
		TT_TOTAL_QTY AS (/*+ materialize */
		SELECT TOT.EQPTID,
		TOT.MAX_QTY,
		CU.CMD_USING_QTY,
		CE.CMD_EMPTY_QTY
		FROM TT_BUF_SUM TOT
		LEFT JOIN TT_USING_QTY CU ON TOT.EQPTID = CU.TO_EQPTID
		LEFT JOIN TT_EMPTY_QTY CE ON TOT.EQPTID = CE.TO_EQPTID
		WHERE 1 = 1
		AND MAX_QTY >= 0)
		SELECT EQ.EQUIPMENT_ID,
		EQ.EQUIPMENT_GROUP_ID,
		EQ.USE_FLAG             AS 사용,
		E.EQUIPMENT_STATE_CODE  AS EIOSTAT,
		E.EIOIFMODE,
		EQ.LANE_ID              AS LANE_ID,
		EQ.EQPT_GR_DETL_TYPE_CODE,
		E.LAST_TRANSACTION_DATE,
		NVL(Q.MAX_QTY, 0)       AS MAX_CMD,
		NVL(Q.CMD_USING_QTY, 0) AS 실반송,
		NVL(Q.CMD_EMPTY_QTY, 0) AS 공반송
		FROM TB_EGN_EQUIP_SPEC_MST EQ
		INNER JOIN TB_EGN_FCTRY_AREA_MST TEFAM
		ON TEFAM.REPRESENTATIVE_FACTORY_CODE = EQ.REPRESENTATIVE_FACTORY_CODE
		AND TEFAM.FACTORY_AREA_ID = EQ.FACTORY_AREA_ID
		INNER JOIN TB_EGN_EQUIP_INFO E
		ON E.REPRESENTATIVE_FACTORY_CODE = EQ.REPRESENTATIVE_FACTORY_CODE
		AND EQ.EQUIPMENT_ID = E.EQUIPMENT_ID
		LEFT JOIN TT_TOTAL_QTY Q
		ON E.EQUIPMENT_ID = Q.EQPTID
		WHERE 1 = 1
		AND EQ.REPRESENTATIVE_FACTORY_CODE = @AREA_ID
		AND EQ.USE_FLAG = 'Y'
		AND EQ.EQUIPMENT_GROUP_ID IN (@EQP_GROUP_ID_LIST) -- option1
		AND EQ.EQUIPMENT_GROUP_ID IN ('CNV', 'STO', 'EOL', 'FOR', 'LAM', 'NND', 'STK')
		AND LENGTH(EQ.EQUIPMENT_ID) = 11
		UNION ALL
		SELECT EQ.EQUIPMENT_ID,
		EQ.EQUIPMENT_GROUP_ID,
		EQ.USE_FLAG             AS 사용,
		E.EQUIPMENT_STATE_CODE  AS EIOSTAT,
		E.EIOIFMODE,
		EQ.LANE_ID              AS LANE_ID,
		EQ.EQPT_GR_DETL_TYPE_CODE,
		E.LAST_TRANSACTION_DATE,
		NVL(Q.MAX_QTY, 0)       AS MAX_CMD,
		NVL(Q.CMD_USING_QTY, 0) AS 실반송,
		NVL(Q.CMD_EMPTY_QTY, 0) AS 공반송
		FROM TB_EGN_EQUIP_SPEC_MST EQ
		INNER JOIN TB_EGN_FCTRY_AREA_MST TEFAM
		ON TEFAM.REPRESENTATIVE_FACTORY_CODE = EQ.REPRESENTATIVE_FACTORY_CODE
		AND TEFAM.FACTORY_AREA_ID = EQ.FACTORY_AREA_ID
		INNER JOIN TB_EGN_EQUIP_INFO E
		ON E.REPRESENTATIVE_FACTORY_CODE = EQ.REPRESENTATIVE_FACTORY_CODE
		AND EQ.EQUIPMENT_ID = E.EQUIPMENT_ID
		LEFT JOIN TT_TOTAL_QTY Q ON E.EQUIPMENT_ID = Q.EQPTID
		WHERE 1 = 1
		AND EQ.REPRESENTATIVE_FACTORY_CODE = @AREA_ID
		AND EQ.USE_FLAG = 'Y'
		AND EQ.EQUIPMENT_GROUP_ID IN (@EQP_GROUP_ID_LIST)
		AND EQ.EQUIPMENT_GROUP_ID IN ('SEL', 'HPC', 'DEG', 'JGF', 'DIS', 'OCV', 'ROL', 'COT')
		AND LENGTH(EQ.EQUIPMENT_ID) = 9
		UNION ALL
		SELECT EQ.EQUIPMENT_ID,
		EQ.EQUIPMENT_GROUP_ID,
		EQ.USE_FLAG             AS 사용,
		E.EQUIPMENT_STATE_CODE  AS EIOSTAT,
		E.EIOIFMODE,
		EQ.LANE_ID              AS LANE_ID,
		EQ.EQPT_GR_DETL_TYPE_CODE,
		E.LAST_TRANSACTION_DATE,
		NVL(Q.MAX_QTY, 0)       AS MAX_CMD,
		NVL(Q.CMD_USING_QTY, 0) AS 실반송,
		NVL(Q.CMD_EMPTY_QTY, 0) AS 공반송
		FROM TB_EGN_EQUIP_SPEC_MST EQ
		INNER JOIN TB_EGN_FCTRY_AREA_MST TEFAM
		ON TEFAM.REPRESENTATIVE_FACTORY_CODE = EQ.REPRESENTATIVE_FACTORY_CODE
		AND TEFAM.FACTORY_AREA_ID = EQ.FACTORY_AREA_ID
		INNER JOIN TB_EGN_EQUIP_INFO E
		ON E.REPRESENTATIVE_FACTORY_CODE = EQ.REPRESENTATIVE_FACTORY_CODE
		ANd EQ.EQUIPMENT_ID = E.EQUIPMENT_ID
		LEFT JOIN TT_TOTAL_QTY Q ON E.EQUIPMENT_ID = Q.EQPTID
		WHERE 1 = 1
		AND EQ.USE_FLAG = 'Y'
		AND EQ.EQUIPMENT_GROUP_ID IN (@EQP_GROUP_ID_LIST)
		AND EQ.EQUIPMENT_GROUP_ID IN ('PKG')
		AND LENGTH(EQ.EQUIPMENT_ID) = 11
		ORDER BY EQUIPMENT_ID
	</MainSQL>
    <Option>
        <Option1 type="VAR" condition="" key="EQP_GROUP_ID_LIST" dataType="string" default=""/>
        <Option2 type="VAR" condition="" key="SYSTEM_TYPE_CODE" dataType="string" default=""/>
        <Option3 type="VAR" condition="" key="AREA_ID" dataType="string" default=""/>
    </Option>
    <AdditionalVariable/>
    <Coloring>
        <EIOSTAT Red="255" Green="155" Blue="155" IsColoringColumn="false" IsTimeCompare="false">
            <F Red="255" Green="155" Blue="155" IsColoringRow="false"/>
            <T Red="255" Green="214" Blue="165" IsColoringRow="false"/>
            <U Red="255" Green="254" Blue="196" IsColoringRow="false"/>
            <W Red="203" Green="255" Blue="169" IsColoringRow="false"/>
            <R Red="203" Green="255" Blue="169" IsColoringRow="false"/>
        </EIOSTAT>
        <EIOIFMODE Red="255" Green="155" Blue="155" IsColoringColumn="false" IsTimeCompare="false">
            <OFF Red="255" Green="158" Blue="158" IsColoringRow="false"/>
            <ON Red="185" Green="243" Blue="252" IsColoringRow="false"/>
        </EIOIFMODE>
        <CSTTYPE Red="255" Green="254" Blue="196" IsColoringColumn="true" IsTimeCompare="false">
            <TRAY Red="255" Green="155" Blue="155" IsColoringRow="false"/>
            <TKAE Red="255" Green="214" Blue="165" IsColoringRow="false"/>
            <U Red="255" Green="254" Blue="196" IsColoringRow="FALSE"/>
        </CSTTYPE>
        <INSDTTM Red="255" Green="155" Blue="155" IsColoringColumn="false" IsTimeCompare="true">
            <TODAY Red="255" Green="155" Blue="155" IsColoringRow="true" condition="FUTURE"/>
            <TOMORROW Red="155" Green="255" Blue="155" IsColoringRow="true" condition="PAST"/>
            <YESTERDAY Red="155" Green="155" Blue="255" IsColoringRow="true" condition="EQUAL"/>
        </INSDTTM>
    </Coloring>
    <EventValues>
		<EQUIPMENT_ID TYPE='string' CallSQL = "SearchEquipmentStateHistory" EventType='Click'/>
		<EQUIPMENT_ID TYPE='string' CallSQL = "SearchEquipmentEioHistory" EventType='Click'/>
    </EventValues>
</SearchEquipmentCurrentState>